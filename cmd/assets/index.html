<!doctype html>
<html lang="en" data-theme="light">
  <head>
    <title>Websocket Test</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="css/style.css" rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://cdn.jsdelivr.net/npm/daisyui@3.5.0/dist/full.css"
      rel="stylesheet"
      type="text/css"
    />
  </head>
  <body>
    <p class="text-center">Hello Golang !</p>

    <div>
      <input
        type="text"
        id="input"
        autocomplete="off"
        class="input max-w-xs w-full "
      />
      <button type="button" class="btn btn-primary" id="send">
        Send it baby
      </button>
    </div>

    <script>
      var input = document.querySelector("#input");
      var button = document.querySelector("#send");

      function WsClient(url) {
        this.ws = new WebSocket(url);
        this.eventListener = {};

        this.on = (event, cb) => (this.eventListener[event] = cb);

        this.emit = (name, data) => {
          let event = {
            event: name,
            data: data,
          };
          let rawData = JSON.stringify(event);
          this.ws.send(rawData);
        };

        this.ws.onmessage = (response) => {
          try {
            let data = JSON.parse(response.data);
            if (data) {
              let cb = this.eventListener[data.event];
              if (cb) cb(data.data);
            }
          } catch (e) {
            console.log(e);
          }
        };
      }

      var ws = new WsClient(
        "ws://" + window.location.origin.replace("http://", "") + "/ws",
      );

      ws.on("response", (data) => {
        console.log("response: ", data);
        let msg = document.createElement("p");
        msg.innerText = data;
        document.body.appendChild(msg);
      });

      button.onclick = () => {
        ws.emit("message", input.value);
      };
    </script>
  </body>
</html>
